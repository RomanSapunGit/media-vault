{% extends 'layouts/base_media_list.html' %}

{% load query_transform %}

{% block title %}
  book list
{% endblock %}

{% block include_content %}
  {% include 'includes/type_filter.html' %}
  {% include 'includes/genre_filter.html' %}
  {% include 'includes/creator_filter.html' %}
{% endblock %}

{% block media_content %}'
  <div class="d-flex flex-column gap-4 flex-md-row justify-content-center mb-3">
  <h2 class="text-primary">Choose the
    {% if query_params.type in type_choices %} {{ query_params.type|lower }}
    {% else %}
      book
    {% endif %}
    among the list</h2>
  </div>
  <div class="mx-1 row g-4 justify-content-center">
    {% for book in book_list %}
      <div class="col-md-6 col-lg-4">
        <div class="card shadow-sm h-100">
          <div class="card-body d-flex flex-column">
            <h5>
              <a class="h5 card-title text-primary" href="{% url 'media:book_detail' pk=book.id %}">
                {{ book.title }}
              </a>
            </h5>

            <p class="card-text text-muted small">
              {{ book.description|truncatechars:200 }}
            </p>

            <div class="mb-2">
            <span class="badge bg-gradient-secondary">
              {{ book.chapters }} chapters
            </span>
              <span class="badge bg-gradient-info text-dark">
              <a href="{% url 'media:book_list' %}?type={{ book.get_type_display }}"
                 class="text-decoration-none text-dark">
                {{ book.get_type_display }}
              </a>
            </span>
              <span class="badge bg-gradient-light text-dark">
                  Publication date:
                {% if book.created_at %}
                  {{ book.created_at }}
                {% else %}
                  Unknown
                {% endif %}
            </span>
            <span class="badge bg-gradient-primary">
            Score:
              {% if book.reviews_avg %}
                {{ book.reviews_avg }}
              {% else %}
                0
              {% endif %}
            </span>
            </div>

            {% if book.creators.exists %}
              <div class="mb-2">
                <strong>Author{{ book.creators.all|length|pluralize }}:</strong>
                {% for creator in book.creators.all|slice:":2" %}
                  <span class="badge bg-gradient-light border text-dark me-1 mb-2">
                  {{ creator.first_name }}
                    {{ creator.last_name }}
                </span>
                {% endfor %}
              </div>
            {% else %}
              <div class="mb-2">
                <strong>Author unknown</strong>
              </div>
            {% endif %}

            {% if book.genres.exists %}
              <div class="d-flex flex-wrap gap-1 mt-auto">
                {% for genre in book.genres.all|slice:":5" %}
                  <a class="badge rounded-pill bg-gradient-success text-white text-decoration-none"
                     href="?{% query_transform request=request genres=genre.name %}">
                    {{ genre.name }}
                  </a>
                {% endfor %}
              </div>
            {% endif %}

            <div class="d-flex my-2">
              <a href="{% url 'media:rating_list' %}?media__title={{ book.title }}
&media={% if book.get_type_display == 'Comics' %}comic{% else %}book{% endif %}">
                Open reviews {{ book.reviews_num }}
              </a>
            </div>

          </div>
        </div>
      </div>
    {% empty %}
      <div class="col-lg-7 text-center mx-auto col-sm-9">
        <div class="alert py-5 rounded shadow">
          <h4 class="mb-3">Nothing to show yet</h4>
          <p class="mb-0">Try adding new books or check your filters.</p>
          <a href="{% url 'media:book_create' %}" class="btn btn-primary mt-3">Create a Book</a>
        </div>
      </div>
    {% endfor %}

  </div>
{% endblock %}
