{% extends 'layouts/base-list.html' %}

{% load query_transform %}

{% block title %}
  book list
{% endblock %}

{% block list_content %}

  <div class="pb-4 container">
    <div class="row">
      <div class="col-lg-7 mx-auto">
        <button class="btn btn-outline-primary w-100 mb-3"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#filterCollapse"
                aria-expanded="false"
                aria-controls="filterCollapse">
          Type Filters
        </button>
        <div id="filterCollapse">
          {% include 'includes/type-nav-buttons.html' %}
          {% include 'includes/genre-nav-buttons.html' %}
        </div>
      </div>
    </div>
  </div>

  <div class="row g-4 justify-content-center">
    {% if book_list %}
      {% for book in book_list %}
        <div class="col-md-6 col-lg-4">
          <div class="card shadow-sm h-100">
            <div class="card-body d-flex flex-column">
              <h5 class="card-title text-primary">{{ book.title }}</h5>

              <p class="card-text text-muted small">
                {{ book.description|truncatechars:200 }}
              </p>

              <div class="mb-2">
            <span class="badge bg-secondary">
              {{ book.chapters }} chapters
            </span>
                <span class="badge bg-info text-dark">
              <a href="{% url 'media:book_list' %}?type={{ book.get_type_display }}"
                 class="text-decoration-none text-dark">
                {{ book.get_type_display }}
              </a>
            </span>
                <span class="badge bg-light text-dark">
              {{ book.created_at }}
            </span>
              </div>

              {% if book.creators.exists %}
                <div class="mb-2">
                  <strong>Author{{ book.creators.all|length|pluralize }}:</strong>
                  {% for creator in book.creators.all %}
                    <span class="badge bg-light border text-dark me-1">
                  {{ creator.first_name }}
                    {{ creator.last_name }}
                </span>
                  {% endfor %}
                </div>
              {% endif %}

              {% if book.genres.exists %}
                <div class="d-flex flex-wrap gap-1 mt-auto">
                  {% for genre in book.genres.all %}
                    <a class="badge rounded-pill bg-success text-white text-decoration-none"
                       href="?{% query_transform request=request genres=genre.name %}">
                      {{ genre.name }}
                    </a>
                  {% endfor %}
                </div>
              {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <div class=" text-center mx-auto col-sm-9">
        <p class=" mb-0 h5">Nothing to show yet</p>
      </div>
    {% endif %}
  </div>
{% endblock %}
